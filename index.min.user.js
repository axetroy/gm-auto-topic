// ==UserScript==
// @name              gm-autotopic (typescript)
// @author            Axetroy
// @collaborator      Axetroy
// @description       gm-autotopic
// @version           0.1.0
// @update            2017-07-16 00:31:37
// @grant             GM_xmlhttpRequest
// @include           http://github.com/*/*
// @include           https://github.com/*/*
// @compatible        chrome  完美运行
// @compatible        firefox  完美运行
// @supportURL        http://www.burningall.com
// @run-at            document-idle
// @contributionURL   troy450409405@gmail.com|alipay.com
// @downloadURL       https://github.com/axetroy/anti-redirect/raw/master/dist/anti-redirect.min.user.js
// @namespace         https://greasyfork.org/zh-CN/users/3400-axetroy
// @license           The MIT License (MIT); http://opensource.org/licenses/MIT
// ==/UserScript==

// Github源码:https://github.com/axetroy/anti-redirect


!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(o,u){function c(t){try{a(r.next(t))}catch(t){u(t)}}function i(t){try{a(r.throw(t))}catch(t){u(t)}}function a(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(c,i)}a((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,u&&(c=u[2&n[0]?"return":n[0]?"throw":"next"])&&!(c=c.call(u,n[1])).done)return c;switch(u=0,c&&(n=[0,c.value]),n[0]){case 0:case 1:c=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,u=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(c=a.trys,!(c=c.length>0&&c[c.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!c||n[1]>c[0]&&n[1]<c[3])){a.label=n[1];break}if(6===n[0]&&a.label<c[1]){a.label=c[1],c=n;break}if(c&&a.label<c[2]){a.label=c[2],a.ops.push(n);break}c[2]&&a.ops.pop(),a.trys.pop();continue}n=e.call(t,a)}catch(t){n=[6,t],u=0}finally{o=c=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,u,c,i,a={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]};return i={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i};Object.defineProperty(e,"__esModule",{value:!0});var u=n(1);(new(function(){function t(){}return t.prototype.init=function(){var t=this;this.makeSureFetchButton(),this.onStateChange(function(){var e=setInterval(function(){clearInterval(e),t.makeSureFetchButton()},500)})},t.prototype.makeSureFetchButton=function(){var t=document.getElementById("topics-list-container"),e=document.querySelector(".js-repo-topics-form-toggle");t&&e&&t.appendChild(this.createButton())},t.prototype.createButton=function(){var t=document.createElement("button");return t.className="btn-link",t.type="button",t.id="fetch-from-package",t.style.color="#4CAF50",t.innerHTML="Fetch from package.json",t.onclick=this.onclickHandler.bind(this),t},t.prototype.onStateChange=function(t){addEventListener("click",function(e){var n=document.querySelector("button.js-repo-topics-form-done");e.target===n&&t(e)},!1)},t.prototype.onclickHandler=function(t){return r(this,void 0,void 0,function(){function e(){var t=document.querySelector(".js-tag-input-selected-tags");if(t){clearInterval(c);var e=Array.from(t.querySelectorAll("input")).map(function(t){return t.value}),n=r.keywords||[],o=document.querySelector("#repo_topics");n.filter(function(t){return t}).filter(function(t){return e.findIndex(function(e){return e===t})<0}).forEach(function(t){o.value=t.replace(/\./g,"-"),o.click(),o.blur()}),o.focus()}}var n,r,u,c;return o(this,function(o){switch(o.label){case 0:if(t.preventDefault(),!(n=document.querySelector(".btn-link.js-repo-topics-form-toggle.js-details-target")))return[2,console.warn("Can't found the button to show topic...")];n.click(),r={},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.fetchPackage()];case 2:return r=o.sent(),[3,4];case 3:return u=o.sent(),console.error(u),[3,4];case 4:return c=setInterval(e,500),[2]}})})},t.prototype.fetchPackage=function(){return r(this,void 0,void 0,function(){var t,e,n,r;return o(this,function(o){switch(o.label){case 0:t=document.querySelector('tr.js-navigation-item td.content a[title="package.json"]'),e=t.href,e=e.replace("/blob/","/").replace("github","raw.githubusercontent")+"?v="+Math.random(),n={},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,u.default.get(e)];case 2:return n=o.sent(),n=JSON.parse(n.response),[3,4];case 3:return r=o.sent(),console.error(r),[3,4];case 4:return[2,n]}})})},t}())).init()},function(t,e,n){!function(e,n){t.exports=n()}(0,function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";function r(t){return"function"==typeof t}var o=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++){e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t};Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t){this.config=t}return t.prototype.create=function(e){return new t(e)},t.prototype.request=function(t,e,n,u,c){return void 0===n&&(n=""),void 0===u&&(u={}),void 0===c&&(c={}),new Promise(function(i,a){var s={method:t,url:e,data:n,header:u},l=o({},s,c),f=l.onreadystatechange,p=l.onerror,h=l.onabort,d=l.ontimeout;l.synchronous=!0,l.onreadystatechange=function(t){r(f)&&f.call(this,t),console.log(t.readyState),4===t.readyState&&(t.status>=200&&t.status<400&&t.finalUrl?i(t):a(t))},l.onerror=function(t){r(p)&&p.call(this,t)},l.onabort=function(t){r(h)&&h.call(this,t),a(t),i()},l.ontimeout=function(t){r(d)&&d.call(this,t),a(t)},console.log(l),GM_xmlhttpRequest(o({},l))})},t.prototype.get=function(t,e,n,r){return this.request("GET",t,e,n,r)},t.prototype.post=function(t,e,n,r){return this.request("POST",t,e,n,r)},t.prototype.put=function(t,e,n,r){return this.request("PUT",t,e,n,r)},t.prototype.delete=function(t,e,n,r){return this.request("DELETE",t,e,n,r)},t.prototype.head=function(t,e,n,r){return this.request("HEAD",t,e,n,r)},t}();e.timeout=5e3;var c=new u({timeout:5e3});e.http=c,e.default=c}])})}]);